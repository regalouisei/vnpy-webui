# VnPy 全功能测试计划

**目标**: 系统测试VnPy所有功能模块，确保在无GUI模式下完全可用

**测试环境**:
- 数据源: OpenCTP TTS (模拟环境)
- Python: 3.x
- 测试模式: 无GUI模式

---

## 一、核心架构测试 (已完成)

### 1.1 事件驱动架构 ✅
- [x] EventEngine 创建与事件处理
- [x] 主引擎 MainEngine 初始化
- [x] 事件注册与分发机制
- [x] 日志事件监听

### 1.2 核心模块 ✅
- [x] vnpy.event - 事件引擎
- [x] vnpy.trader.engine - 主引擎
- [x] vnpy.trader.object - 数据对象
- [x] vnpy.trader.event - 事件定义

---

## 二、网关测试 (已完成)

### 2.1 CTP网关 ✅
- [x] 网关连接
- [x] 交易服务器连接
- [x] 行情服务器连接
- [x] 登录认证
- [x] 断线重连机制

### 2.2 多网关支持
- [ ] 网关切换测试
- [ ] 多网关同时运行
- [ ] 网关数据同步
- [ ] 其他网关兼容性 (IB, OES等)

---

## 三、数据查询测试 (已完成)

### 3.1 账户数据 ✅
- [x] 账户余额查询
- [x] 可用资金查询
- [x] 冻结资金查询
- [x] 账户事件监听

### 3.2 持仓数据 ✅
- [x] 持仓查询
- [x] 多品种持仓
- [x] 持仓盈亏计算
- [x] 持仓事件监听

### 3.3 合约数据 ✅
- [x] 合约列表查询
- [x] 合约详细信息
- [x] 合约过滤 (交易所/品种)
- [x] 合约事件监听

### 3.4 订单数据
- [ ] 订单查询
- [ ] 订单状态跟踪
- [ ] 委托撤单
- [ ] 订单事件监听

### 3.5 成交数据
- [ ] 成交记录查询
- [ ] 成交明细
- [ ] 成交事件监听

---

## 四、行情数据测试 (已完成)

### 4.1 实时行情 ✅
- [x] 行情订阅
- [x] Tick数据接收
- [x] 多合约订阅
- [x] 行情事件监听

### 4.2 K线数据
- [ ] 1分钟K线
- [ ] 5分钟K线
- [ ] 日K线
- [ ] 周K线
- [ ] 月K线
- [ ] K线事件监听

### 4.3 历史行情
- [ ] 历史Tick下载
- [ ] 历史K线下载
- [ ] 数据补全机制
- [ ] 数据存储

---

## 五、CTA策略测试

### 5.1 CTA策略引擎 ✅
- [x] 引擎初始化
- [x] 数据库连接
- [x] 策略模板加载

### 5.2 策略生命周期
- [ ] 策略添加
- [ ] 策略初始化
- [ ] 策略启动
- [ ] 策略停止
- [ ] 策略编辑
- [ ] 策略删除

### 5.3 策略事件处理
- [ ] on_init - 初始化事件
- [ ] on_start - 启动事件
- [ ] on_stop - 停止事件
- [ ] on_tick - Tick事件
- [ ] on_bar - K线事件
- [ ] on_order - 订单事件
- [ ] on_trade - 成交事件
- [ ] on_position - 持仓事件

### 5.4 内置策略测试
测试所有9个内置策略:
- [ ] MultiTimeframeStrategy - 多时间框架
- [ ] DualThrustStrategy - 双通道
- [ ] DoubleMaStrategy - 双均线
- [ ] TurtleSignalStrategy - 海龟交易
- [ ] AtrRsiStrategy - ATR+RSI
- [ ] BollChannelStrategy - 布林通道
- [ ] TestStrategy - 测试策略
- [ ] MultiSignalStrategy - 多信号
- [ ] KingKeltnerStrategy - 金肯特纳

### 5.5 自定义策略
- [ ] SimpleDoubleMaStrategy - 自定义双均线
- [ ] 策略参数配置
- [ ] 策略信号生成
- [ ] 订单执行

---

## 六、回测功能测试

### 6.1 回测引擎
- [ ] BacktestingEngine 初始化
- [ ] 历史数据加载
- [ ] 回测参数设置
- [ ] 回测执行

### 6.2 回测结果
- [ ] 收益曲线
- [ ] 回撤分析
- [ ] 夏普比率
- [ ] 胜率统计
- [ ] 最大回撤
- [ ] 交易明细

### 6.3 回测优化
- [ ] 参数扫描
- [ ] 参数优化
- [ ] 结果对比
- [ ] 最优参数选择

---

## 七、实盘交易测试

### 7.1 订单执行
- [ ] 限价单
- [ ] 市价单
- [ ] 条件单
- [ ] 止损单
- [ ] 止盈单
- [ ] 冰山单

### 7.2 风险管理
- [ ] 仓位管理
- [ ] 风控参数设置
- [ ] 止损机制
- [ ] 爆仓防护
- [ ] 最大持仓限制
- [ ] 最大亏损限制

### 7.3 实盘监控
- [ ] 实时盈亏计算
- [ ] 风险指标监控
- [ ] 异常报警
- [ ] 交易日志记录

---

## 八、数据管理测试

### 8.1 数据服务
- [ ] vnpy_sqlite - SQLite数据服务
- [ ] vnpy_mysql - MySQL数据服务
- [ ] vnpy_postgresql - PostgreSQL数据服务

### 8.2 数据存储
- [ ] Tick数据存储
- [ ] K线数据存储
- [ ] 交易记录存储
- [ ] 策略记录存储

### 8.3 数据查询
- [ ] 历史数据查询
- [ ] 时间范围查询
- [ ] 品种过滤
- [ ] 数据导出

### 8.4 数据管理
- [ ] 数据导入
- [ ] 数据导出
- [ ] 数据备份
- [ ] 数据清理

---

## 九、风险管理测试

### 9.1 风控引擎
- [ ] 风控规则配置
- [ ] 风控触发检测
- [ ] 风控执行

### 9.2 风控规则
- [ ] 最大持仓限制
- [ ] 最大亏损限制
- [ ] 单笔交易限制
- [ ] 涨跌停限制

---

## 十、组合策略测试

### 10.1 组合引擎
- [ ] PortfolioEngine 初始化
- [ ] 组合策略加载
- [ ] 组合管理

### 10.2 价差套利
- [ ] 跨期套利
- [ ] 跨品种套利
- [ ] 统计套利

---

## 十一、期权交易测试

### 11.1 期权数据
- [ ] 期权合约查询
- [ ] 波动率数据
- [ ] 希腊字母计算

### 11.2 期权策略
- [ ] 买入看涨/看跌
- [ ] 卖出看涨/看跌
- [ ] 组合策略 (价差、跨式等)

---

## 十二、算法交易测试

### 12.1 算法引擎
- [ ] AlgoEngine 初始化
- [ ] 算法策略加载

### 12.2 算法订单
- [ ] TWAP - 时间加权平均
- [ ] VWAP - 成交量加权平均
- [ ] POV - 挂单比例

---

## 十三、脚本策略测试

### 13.1 脚本引擎
- [ ] ScriptEngine 初始化
- [ ] 脚本加载
- [ ] 脚本执行

### 13.2 脚本功能
- [ ] 脚本策略编写
- [ ] 脚本参数设置
- [ ] 脚本日志输出

---

## 十四、AI量化测试

### 14.1 vnpy.alpha
- [ ] Alpha因子库
- [ ] 因子计算
- [ ] 因子分析

### 14.2 机器学习
- [ ] 模型训练
- [ ] 模型预测
- [ ] 模型评估

---

## 十五、VeighNa Station测试

### 15.1 CLI模式
- [ ] 命令行交互
- [ ] 命令执行
- [ ] 日志输出

### 15.2 配置管理
- [ ] 配置文件读取
- [ ] 配置文件写入
- [ ] 配置更新

---

## 十六、Web Trader测试

### 16.1 Web API
- [ ] API服务器启动
- [ ] RESTful接口
- [ ] WebSocket接口
- [ ] 认证机制

### 16.2 Web功能
- [ ] 账户查询API
- [ ] 持仓查询API
- [ ] 行情订阅API
- [ ] 订单下单API
- [ ] 策略管理API

---

## 十七、图表和工具测试

### 17.1 K线图表
- [ ] K线数据准备
- [ ] K线绘制逻辑
- [ ] 技术指标叠加
- [ ] 图表数据导出

### 17.2 技术指标
- [ ] MA - 均线
- [ ] MACD
- [ ] KDJ
- [ ] RSI
- [ ] BOLL - 布林带
- [ ] ATR

### 17.3 工具函数
- [ ] 数据分析工具
- [ ] 统计分析工具
- [ ] 回测报告生成

---

## 十八、文档测试

### 18.1 安装文档
- [ ] 环境要求
- [ ] 依赖安装
- [ ] 配置步骤
- [ ] 验证方法

### 18.2 使用文档
- [ ] 核心概念
- [ ] 快速开始
- [ ] 功能说明
- [ ] 示例代码

### 18.3 API文档
- [ ] 核心API
- [ ] 策略API
- [ ] 数据API
- [ ] 工具API

---

## 十九、集成测试

### 19.1 端到端流程
- [ ] 连接 -> 订阅行情 -> 启动策略 -> 实盘交易 -> 监控
- [ ] 数据下载 -> 回测 -> 优化 -> 实盘

### 19.2 压力测试
- [ ] 多合约订阅
- [ ] 多策略运行
- [ ] 高频数据处理
- [ ] 长时间运行

---

## 二十、Web UI测试 (后续)

### 20.1 Web UI框架
- [ ] 前端框架选择
- [ ] 后端API集成
- [ ] 实时数据推送

### 20.2 Web UI功能
- [ ] 账户管理界面
- [ ] 持仓管理界面
- [ ] 行情显示界面
- [ ] K线图表界面
- [ ] 策略管理界面
- [ ] 回测界面
- [ ] 交易界面
- [ ] 数据管理界面
- [ ] 报表分析界面

---

## 测试执行顺序

### 第一阶段: 基础功能 (已完成)
1. ✅ 核心架构
2. ✅ CTP网关
3. ✅ 数据查询
4. ✅ 实时行情

### 第二阶段: 策略功能 (进行中)
5. CTA策略完整测试
6. 回测功能测试
7. 脚本策略测试

### 第三阶段: 高级功能
8. 组合策略
9. 期权交易
10. 算法交易
11. AI量化

### 第四阶段: 数据与管理
12. 数据管理完整测试
13. 风险管理
14. VeighNa Station CLI

### 第五阶段: 文档与集成
15. 文档编写
16. 集成测试
17. 压力测试

### 第六阶段: Web UI (最后)
18. Web UI设计与开发
19. Web UI测试
20. Web UI部署

---

## 测试工具

### 测试脚本
- `test_core.py` - 核心功能测试
- `test_gateway.py` - 网关测试
- `test_data.py` - 数据查询测试
- `test_market.py` - 行情测试
- `test_cta_strategy.py` - CTA策略测试
- `test_backtest.py` - 回测测试
- `test_real_trading.py` - 实盘交易测试
- `test_data_manager.py` - 数据管理测试
- `test_risk.py` - 风险管理测试
- `test_portfolio.py` - 组合策略测试
- `test_option.py` - 期权交易测试
- `test_algo.py` - 算法交易测试
- `test_script.py` - 脚本策略测试
- `test_alpha.py` - AI量化测试
- `test_integration.py` - 集成测试
- `test_stress.py` - 压力测试

### 测试报告
- 每个测试脚本生成独立报告
- 汇总报告 `TEST_SUMMARY.md`
- 覆盖率报告 `COVERAGE_REPORT.md`

---

## 成功标准

### 功能完整性
- [ ] 所有核心功能正常运行
- [ ] 所有API接口可用
- [ ] 所有事件正常触发

### 性能标准
- [ ] 行情延迟 < 1秒
- [ ] 订单执行 < 0.5秒
- [ ] 数据查询 < 0.1秒
- [ ] 回测速度合理

### 稳定性
- [ ] 24小时稳定运行
- [ ] 内存使用稳定
- [ ] 无内存泄漏
- [ ] 无异常崩溃

### 文档完整性
- [ ] 安装文档清晰
- [ ] 使用文档完整
- [ ] API文档准确
- [ ] 示例代码可运行

---

## 下一步行动

1. **立即执行**: 创建所有测试脚本
2. **优先级**: CTA策略 → 回测 → 数据管理
3. **并行**: 文档编写与功能测试
4. **最后**: Web UI开发

---

**创建时间**: 2026-02-20
**负责人**: 总指挥 (zongzhihui)
**状态**: 计划阶段
