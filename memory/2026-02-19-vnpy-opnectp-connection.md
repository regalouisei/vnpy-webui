# VNPY + OpenCTP 连接任务记忆

**日期**: 2026-02-19
**任务**: VNPY + vnpy-ctp + OpenCTP 7x24 模拟服务器连接测试
**负责人**: zongzhihui (总指挥)
**优先状态**: 待用户反馈

---

## 任务背景

用户要求继续之前由 @tianxinfengbot 执行的任务：将 OpenCTP 模拟账号链接进 vn.py。

---

## 当前系统状态

### ✅ 正常运行
- **Web 界面**: http://154.219.126.12:8080/veighna_final_with_cline.html
- **FastAPI 后端**: veighna_clean.py (端口 8080)
- **数据模式**: 模拟数据模式 (SIMULATION)
- **界面功能**: VeighNa 风格，完全兼容卡巴斯基，支持 K 线图表、交易功能

### ❌ 连接失败
- **vn.py 连接**: 失败
- **目标服务器**: OpenCTP 7x24 模拟服务器
- **实际配置**: SimNow 测试服务器 (tcp://180.168.1.1:41205/41213)
- **网络测试**: 超时 (连接失败)
- **数据接收**: 未接收到任何账户、持仓、订单、成交、行情数据

---

## 问题诊断

### 根本问题：目标混淆

```
任务目标: OpenCTP 7x24 模拟服务器
实际配置: SimNow 测试服务器 (180.168.1.1:41205, 41213)
```

这是两个不同的服务！

### 网络连接问题

```
180.168.1.1:41205 (交易端口) → 超时
180.168.1.1:41213 (行情端口) → 超时
```

可能原因：
- SimNow 服务器维护中
- 防火墙阻止
- IP 被限制
- 端口变更

---

## 测试的脚本

| 脚本 | 路径 | 结果 |
|------|------|------|
| vnpy_connect_opensim_7x24_debug.py | /root/.openclaw/workspace/vnpy_trading/ | 连接请求发送成功，但未收到任何数据 |
| vnpy_diagnostic.py | /root/.openclaw/workspace/vnpy_trading/ | 诊断显示网络连接失败 |
| vnpy_ctp_connect_opensim_7x24_v6.py | /root/.openclaw/workspace/vnpy_trading/ | 尝试多种方法连接 |

---

## 解决方案

### 方案 A：使用模拟数据 (当前状态 - 推荐)

**优点**：
- ✅ 系统完全稳定，不依赖外部连接
- ✅ Web 界面正常工作
- ✅ 所有功能可测试
- ✅ 用户之前标记为"强烈推荐"

**状态**: 已实施，运行良好

---

### 方案 B：连接真实的 OpenCTP 7x24

**需要用户提供**：
1. OpenCTP 7x24 模拟服务器的地址和端口
2. 正确的模拟账号和密码
3. 产品名称和授权编码（如果需要）

**可以执行**：
1. 创建连接脚本
2. 集成到 FastAPI 后端
3. 替换模拟数据为真实数据

---

### 方案 C：修复 SimNow 连接

**需要排查**：
1. 检查 SimNow 服务器状态
2. 尝试不同的 SimNow 账号
3. 检查 VPS 防火墙规则
4. 验证网络路由

---

## 用户待反馈

1. **是否有 OpenCTP 7x24 模拟服务器的正确配置信息？**
   - 服务器地址和端口
   - 账号和密码
   - 其他必需参数

2. **是否继续使用当前的模拟数据模式？**
   - 如果是，继续优化系统
   - 如果需要，增强模拟数据的真实性

3. **方案的优先级？**
   - 稳定性优先 → 继续模拟数据
   - 真实性优先 → 找到真实连接
   - 混合方案 → 两者都支持

---

## 技术细节

### 当前配置 (SimNow)
```
账号: 17130
密码: 123456
经纪商代码: 9999
交易服务器: tcp://180.168.1.1:41205
行情服务器: tcp://180.168.1.1:41213
产品名称: simnow_client
授权编码: (空)
柜台环境: 测试
```

### FastAPI 后端状态
```json
{
  "connected": true,
  "gateway_status": "模拟数据模式（VeighNa 最终版本）",
  "mode": "SIMULATION",
  "last_error": null
}
```

---

## 工作目录

`/root/.openclaw/workspace/vnpy_trading/`

---

## 下一步

等待用户反馈后：
- 如果提供 OpenCTP 7x24 配置 → 创建真实连接
- 如果选择模拟数据 → 继续优化系统
- 如果需要混合方案 → 实现多数据源支持

---

**记忆创建时间**: 2026-02-19 14:20 UTC
**最后更新**: 2026-02-19 14:20 UTC
