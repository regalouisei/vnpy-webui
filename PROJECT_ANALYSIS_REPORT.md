# é‡åŒ–å·¥å‚é¡¹ç›®å®Œæ•´åˆ†ææŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: 2026-02-21
**é¡¹ç›®åç§°**: VnPy åŠŸèƒ½æµ‹è¯•ä¸ Web UI å¼€å‘
**è´Ÿè´£äºº**: æ€»æŒ‡æŒ¥ (zongzhihui)
**å½“å‰çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•å®Œæˆï¼Œå‡†å¤‡ Web UI å¼€å‘

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [é¡¹ç›®ç»“æ„è¯¦è§£](#2-é¡¹ç›®ç»“æ„è¯¦è§£)
3. [æ ¸å¿ƒæ¨¡å—åŠŸèƒ½](#3-æ ¸å¿ƒæ¨¡å—åŠŸèƒ½)
4. [å›æµ‹æœºåˆ¶è¯¦è§£](#4-å›æµ‹æœºåˆ¶è¯¦è§£)
5. [æ•°æ®æºä¸å®æ—¶æ•°æ®](#5-æ•°æ®æºä¸å®æ—¶æ•°æ®)
6. [ç½‘é¡µéƒ¨ç½²æ–¹æ¡ˆ](#6-ç½‘é¡µéƒ¨ç½²æ–¹æ¡ˆ)
7. [ä½¿ç”¨æŒ‡å—](#7-ä½¿ç”¨æŒ‡å—)
8. [æŠ€æœ¯æ¶æ„](#8-æŠ€æœ¯æ¶æ„)
9. [é¡¹ç›®è¿›åº¦ä¸æœªæ¥è§„åˆ’](#9-é¡¹ç›®è¿›åº¦ä¸æœªæ¥è§„åˆ’)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

é‡åŒ–å·¥å‚æ˜¯åŸºäº **VnPy é‡åŒ–äº¤æ˜“æ¡†æ¶** çš„å®Œæ•´æµ‹è¯•ä¸å¼€å‘é¡¹ç›®ï¼Œæ—¨åœ¨æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€å¯æ‰©å±•çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿã€‚é¡¹ç›®ä»åŠŸèƒ½æµ‹è¯•å¼€å§‹ï¼ŒéªŒè¯ VnPy æ¡†æ¶çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶åŸºäºæ­¤å¼€å‘ Web ç”¨æˆ·ç•Œé¢ï¼Œè¾¾åˆ°ç”šè‡³è¶…è¿‡ VeighNa Studio çš„æ°´å¹³ã€‚

### 1.2 é¡¹ç›®ç›®æ ‡

**é˜¶æ®µä¸€ï¼šåŠŸèƒ½æµ‹è¯•ï¼ˆå·²å®Œæˆ 100%ï¼‰**
- âœ… æµ‹è¯• VnPy æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- âœ… éªŒè¯äº‹ä»¶é©±åŠ¨æ¶æ„
- âœ… éªŒè¯å¤šç½‘å…³æ”¯æŒï¼ˆCTPï¼‰
- âœ… éªŒè¯ç­–ç•¥å¼€å‘æ¡†æ¶
- âœ… éªŒè¯å›æµ‹åŠŸèƒ½
- âœ… éªŒè¯å®ç›˜äº¤æ˜“
- âœ… éªŒè¯æ•°æ®ç®¡ç†

**é˜¶æ®µäºŒï¼šWeb UI å¼€å‘ï¼ˆå¾…å¼€å§‹ï¼‰**
- â¸ï¸ å¼€å‘ Web åç«¯ API
- â¸ï¸ å¼€å‘ Web å‰ç«¯ç•Œé¢
- â¸ï¸ å®ç°æ‰€æœ‰ VnPy åŠŸèƒ½çš„å¯è§†åŒ–ç®¡ç†
- â¸ï¸ å®ç°é«˜çº§ K çº¿å›¾è¡¨
- â¸ï¸ å®ç°å®æ—¶æ•°æ®æ¨é€

### 1.3 æŠ€æœ¯æ ˆ

| åˆ†ç±» | æŠ€æœ¯ |
|------|------|
| **æ ¸å¿ƒæ¡†æ¶** | VnPy 3.x / 4.x |
| **ç¼–ç¨‹è¯­è¨€** | Python 3.10+ |
| **æ•°æ®æº** | OpenCTP TTSï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰ |
| **æ•°æ®åº“** | SQLiteï¼ˆé»˜è®¤ï¼‰ã€MySQLã€PostgreSQL |
| **æµ‹è¯•æ¡†æ¶** | unittestã€è‡ªå®šä¹‰æµ‹è¯•æ¡†æ¶ |
| **Web åç«¯** | FastAPIï¼ˆè§„åˆ’ä¸­ï¼‰ |
| **Web å‰ç«¯** | React / Vueï¼ˆè§„åˆ’ä¸­ï¼‰ |
| **æ•°æ®å¯è§†åŒ–** | Plotly / EChartsï¼ˆè§„åˆ’ä¸­ï¼‰ |
| **å®æ—¶é€šä¿¡** | WebSocket |

---

## 2. é¡¹ç›®ç»“æ„è¯¦è§£

### 2.1 å®Œæ•´ç›®å½•ç»“æ„

```
quant-factory/
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒæ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                    # é¡¹ç›®æ€»è§ˆï¼ˆ11KBï¼‰
â”‚   â”œâ”€â”€ FILE_STRUCTURE.md            # æ–‡ä»¶ç»“æ„è¯´æ˜ï¼ˆ7.3KBï¼‰
â”‚   â”œâ”€â”€ AGENTS.md                    # Agent é…ç½®ï¼ˆ9.4KBï¼‰
â”‚   â”œâ”€â”€ CHECKLIST.md                 # æ£€æŸ¥æ¸…å•ï¼ˆ3.9KBï¼‰
â”‚   â”œâ”€â”€ MEMORY.md                    # è®°å¿†å­˜å‚¨ï¼ˆ689Bï¼‰
â”‚   â””â”€â”€ SOUL.md                      # Agent çµé­‚ï¼ˆ4.6KBï¼‰
â”‚
â”œâ”€â”€ ğŸ“ docs/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ VNPY_COMPREHENSIVE_TEST_PLAN.md   # å®Œæ•´æµ‹è¯•è®¡åˆ’
â”‚   â”œâ”€â”€ VNPY_COMPLETE_GUIDE.md            # å®‰è£…ä¸ä½¿ç”¨æŒ‡å—ï¼ˆ21KBï¼‰
â”‚   â”œâ”€â”€ TEST_PROGRESS.md                  # æµ‹è¯•è¿›åº¦è¿½è¸ªï¼ˆ7.3KBï¼‰
â”‚   â”œâ”€â”€ VNPY_ARCHITECTURE_DEEP_DIVE.md    # æ¶æ„æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_BACKTESTING_DEEP_DIVE.md     # å›æµ‹å¼•æ“æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_DATA_MANAGEMENT_DEEP_DIVE.md # æ•°æ®ç®¡ç†æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_WEB_API_DEEP_DIVE.md         # Web API æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_CTA_STRATEGY_DEEP_DIVE.md    # CTA ç­–ç•¥æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_RISK_MANAGEMENT_DEEP_DIVE.md # é£é™©ç®¡ç†æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_PORTFOLIO_STRATEGY_DEEP_DIVE.md # ç»„åˆç­–ç•¥æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_ALGO_TRADING_DEEP_DIVE.md    # ç®—æ³•äº¤æ˜“æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_OPTION_TRADING_DEEP_DIVE.md  # æœŸæƒäº¤æ˜“æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_SCRIPT_TRADER_DEEP_DIVE.md   # è„šæœ¬äº¤æ˜“æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_AI_QUANT_DEEP_DIVE.md        # AI é‡åŒ–æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_STATION_DEEP_DIVE.md         # VeighNa Station æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_CTP_DEEP_DIVE.md             # CTP ç½‘å…³æ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_EVENT_SYSTEM_DEEP_DIVE.md     # äº‹ä»¶ç³»ç»Ÿæ·±åº¦è§£æ
â”‚   â”œâ”€â”€ VNPY_CORE_DEEP_DIVE.md            # æ ¸å¿ƒç»„ä»¶æ·±åº¦è§£æ
â”‚   â””â”€â”€ VNPY_DEEP_DIVE_SUMMARY.md         # æ·±åº¦è§£ææ±‡æ€»
â”‚
â”œâ”€â”€ ğŸ”§ æµ‹è¯•è„šæœ¬ï¼ˆæ ¹ç›®å½•ï¼‰
â”‚   â”œâ”€â”€ run_all_tests.py                  # ä¸»æµ‹è¯•è„šæœ¬ï¼ˆ8.9KBï¼‰
â”‚   â”œâ”€â”€ complete_test_suite.py            # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼ˆ12.7KBï¼‰âœ…
â”‚   â”œâ”€â”€ test_cta_strategy_comprehensive.py  # CTA ç­–ç•¥å®Œæ•´æµ‹è¯•ï¼ˆ17.9KBï¼‰
â”‚   â”œâ”€â”€ test_backtest_comprehensive.py     # å›æµ‹åŠŸèƒ½å®Œæ•´æµ‹è¯•ï¼ˆ23.5KBï¼‰
â”‚   â”œâ”€â”€ test_data_manager_comprehensive.py # æ•°æ®ç®¡ç†å®Œæ•´æµ‹è¯•ï¼ˆ26.3KBï¼‰
â”‚   â”œâ”€â”€ test_integration.py               # é›†æˆæµ‹è¯•ï¼ˆ13KBï¼‰
â”‚   â”œâ”€â”€ test_advanced_functions.py        # é«˜çº§åŠŸèƒ½æµ‹è¯•ï¼ˆ11KBï¼‰
â”‚   â””â”€â”€ test_core_functions.py            # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼ˆ8.5KBï¼‰
â”‚
â”œâ”€â”€ ğŸ“ strategies/                     # ç­–ç•¥ç›®å½•
â”‚   â””â”€â”€ simple_double_ma_strategy.py      # åŒå‡çº¿ç­–ç•¥ç¤ºä¾‹ï¼ˆ2KBï¼‰
â”‚
â”œâ”€â”€ ğŸ“ agents/                         # Agent ç›®å½•
â”‚   â”œâ”€â”€ researcher/                    # ç ”ç©¶å‘˜ï¼ˆå½“å‰è°ƒåº¦è€…ï¼‰ğŸ”¬
â”‚   â”œâ”€â”€ coder/                         # å·¥ç¨‹å¸ˆ ğŸ’»
â”‚   â”œâ”€â”€ tester/                        # æµ‹è¯•å‘˜ ğŸ§ª
â”‚   â”œâ”€â”€ writer/                        # æ–‡æ¡£å¸ˆ ğŸ“
â”‚   â”œâ”€â”€ data/                          # æ•°æ®å·¥ç¨‹å¸ˆ ğŸ“Š
â”‚   â”œâ”€â”€ analyst/                       # åˆ†æå¸ˆ ğŸ“ˆ
â”‚   â”œâ”€â”€ junshi/                        # å†›å¸ˆ ğŸ§ 
â”‚   â”œâ”€â”€ zhiku/                         # æ™ºåº“ ğŸ“š
â”‚   â””â”€â”€ zongzhihui/                    # æ€»æŒ‡æŒ¥ ğŸ¯
â”‚
â”œâ”€â”€ ğŸ“ shared/                         # å…±äº«ç›®å½•
â”‚   â”œâ”€â”€ GOALS.md                       # ç›®æ ‡
â”‚   â”œâ”€â”€ PROJECTS.md                    # é¡¹ç›®
â”‚   â”œâ”€â”€ DECISIONS.md                   # å†³ç­–
â”‚   â”œâ”€â”€ ENGINEERS.md                   # å·¥ç¨‹å¸ˆ
â”‚   â””â”€â”€ TEAM-RULEBOOK.md               # å›¢é˜Ÿè§„åˆ™
â”‚
â”œâ”€â”€ ğŸ“ memory/                         # è®°å¿†ç›®å½•
â”‚   â””â”€â”€ 2026-02-*.md                  # æ¯æ—¥è®°å¿†
â”‚
â”œâ”€â”€ ğŸ“ logs/                           # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ test_*.log                    # æµ‹è¯•æ—¥å¿—
â”‚   â”œâ”€â”€ FINAL_TEST_REPORT.md          # æœ€ç»ˆæµ‹è¯•æŠ¥å‘Š
â”‚   â””â”€â”€ TEST_COMPLETION_REPORT.md      # æµ‹è¯•å®ŒæˆæŠ¥å‘Š
â”‚
â”œâ”€â”€ ğŸ“ data/                           # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ database.db                    # SQLite æ•°æ®åº“ï¼ˆå¦‚ä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ ğŸ“ veighna_station/               # VeighNa Station CLI
â”‚   â””â”€â”€ ...                            # ç›¸å…³æ–‡ä»¶
â”‚
â””â”€â”€ ğŸ“ vnpy-webui/                    # Web UI å¼€å‘ç›®å½•
    â””â”€â”€ ...                            # ç›¸å…³æ–‡ä»¶
```

### 2.2 æ–‡ä»¶ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| **Python æ–‡ä»¶** | 74 | æµ‹è¯•è„šæœ¬ã€ç­–ç•¥ã€å·¥å…· |
| **Markdown æ–‡æ¡£** | 20+ | æ·±åº¦è§£ææ–‡æ¡£ã€æŒ‡å— |
| **é…ç½®æ–‡ä»¶** | 5 | Agent é…ç½®ã€ç³»ç»Ÿè®¾ç½® |
| **æ—¥å¿—æ–‡ä»¶** | 10+ | æµ‹è¯•æ—¥å¿—ã€æŠ¥å‘Š |
| **æ€»å¤§å°** | ~500KB | æ ¸å¿ƒä»£ç å’Œæ–‡æ¡£ |

---

## 3. æ ¸å¿ƒæ¨¡å—åŠŸèƒ½

### 3.1 VnPy æ ¸å¿ƒæ¶æ„

VnPy é‡‡ç”¨**äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼Œæ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VnPy æ ¸å¿ƒæ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  MainEngine  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Gateway    â”‚              â”‚
â”‚  â”‚  ï¼ˆä¸»å¼•æ“ï¼‰  â”‚  RPC    â”‚  ï¼ˆCTPç­‰ï¼‰    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                                â”‚
â”‚         â”‚ äº‹ä»¶é©±åŠ¨                                       â”‚
â”‚         â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           å„ç±»å¼•æ“ï¼ˆè®¢é˜…äº‹ä»¶ï¼‰                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ CtaEngine     - CTAç­–ç•¥å¼•æ“                   â”‚   â”‚
â”‚  â”‚  â€¢ AlgoEngine    - ç®—æ³•äº¤æ˜“å¼•æ“                  â”‚   â”‚
â”‚  â”‚  â€¢ PortfolioEngine - ç»„åˆç­–ç•¥å¼•æ“                â”‚   â”‚
â”‚  â”‚  â€¢ OptionEngine   - æœŸæƒäº¤æ˜“å¼•æ“                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           æ•°æ®åº“å±‚                               â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ SQLite / MySQL / PostgreSQL                 â”‚   â”‚
â”‚  â”‚  â€¢ æ”¯æŒå¤šæ•°æ®åº“åˆ‡æ¢                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å›æµ‹å¼•æ“ï¼ˆBacktestingEngineï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- å†å²æ•°æ®å›æ”¾
- è®¢å•æ’®åˆæ¨¡æ‹Ÿ
- èµ„é‡‘è®¡ç®—
- ç»Ÿè®¡æŒ‡æ ‡ç”Ÿæˆ
- å‚æ•°ä¼˜åŒ–

**æ€§èƒ½ç‰¹ç‚¹**ï¼š
- æ”¯æŒä¸¤ç§æ¨¡å¼ï¼šKçº¿æ¨¡å¼ï¼ˆBARï¼‰å’Œ Tick æ¨¡å¼
- å‚æ•°ä¼˜åŒ–æ”¯æŒæš´åŠ›æœç´¢å’Œé—ä¼ ç®—æ³•
- æ”¯æŒå¤šè¿›ç¨‹å¹¶è¡Œè®¡ç®—

### 3.3 CTA ç­–ç•¥å¼•æ“ï¼ˆCtaEngineï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ç­–ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆåˆå§‹åŒ–ã€å¯åŠ¨ã€åœæ­¢ï¼‰
- è®¢å•ç®¡ç†ï¼ˆå‘é€ã€æ’¤é”€ã€æŸ¥è¯¢ï¼‰
- åœæ­¢å•ç®¡ç†
- äº¤æ˜“ä¿¡å·å¤„ç†
- ç­–ç•¥æ¨¡æ¿ç³»ç»Ÿ

**å†…ç½®ç­–ç•¥**ï¼ˆ9ä¸ªï¼‰ï¼š
1. AtrRsiStrategy - ATR RSI ç­–ç•¥
2. BollChannelStrategy - å¸ƒæ—é€šé“ç­–ç•¥
3. CciStrategy - CCI ç­–ç•¥
4. DoubleMaStrategy - åŒå‡çº¿ç­–ç•¥
5. IchimokuStrategy - ä¸€ç›®å‡è¡¡è¡¨ç­–ç•¥
6. KingKeltnerStrategy - King Keltner ç­–ç•¥
7. RsiBreakStrategy - RSI çªç ´ç­–ç•¥
8. TurtleSignalStrategy - æµ·é¾Ÿä¿¡å·ç­–ç•¥
9. MultiTimeframeStrategy - å¤šå‘¨æœŸç­–ç•¥

### 3.4 æ•°æ®ç®¡ç†æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- æ•°æ®å­˜å‚¨ï¼ˆæ”¯æŒå¤šæ•°æ®åº“ï¼‰
- æ•°æ®æŸ¥è¯¢ï¼ˆå¸¦ç¼“å­˜ï¼‰
- æ•°æ®å¯¼å…¥å¯¼å‡ºï¼ˆCSVã€Excelã€JSONã€Parquetï¼‰
- æ•°æ®å¤‡ä»½æ¢å¤
- æ•°æ®åŒæ­¥

**æ”¯æŒçš„æ•°æ®åº“**ï¼š
- SQLiteï¼ˆé»˜è®¤ï¼Œè½»é‡çº§ï¼‰
- MySQLï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- PostgreSQLï¼ˆé«˜æ€§èƒ½ï¼‰

### 3.5 é£é™©ç®¡ç†æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- é£é™©åº¦ç›‘æ§
- æŒä»“é™åˆ¶
- å•ç¬”æ­¢æŸ
- æ¯æ—¥æ­¢æŸ
- èµ„é‡‘ä½¿ç”¨ç‡ç›‘æ§

### 3.6 Web API æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- RESTful API æ¥å£
- WebSocket å®æ—¶æ¨é€
- JWT è®¤è¯æˆæƒ
- åŒè¿›ç¨‹æ¶æ„ï¼ˆWeb è¿›ç¨‹ + äº¤æ˜“è¿›ç¨‹ï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- åç«¯ï¼šFastAPI
- å‰ç«¯ï¼šReact / Vue
- å®æ—¶é€šä¿¡ï¼šWebSocket
- æ•°æ®å¯è§†åŒ–ï¼šPlotly / ECharts

---

## 4. å›æµ‹æœºåˆ¶è¯¦è§£

### 4.1 å›æµ‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ›å»ºå¼•æ“  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è®¾ç½®å‚æ•°  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ·»åŠ ç­–ç•¥  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. åŠ è½½æ•°æ®  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ä»æ•°æ®åº“åŠ è½½å†å²æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è¿è¡Œå›æµ‹  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º äº‹ä»¶é©±åŠ¨ï¼Œé€æ ¹Kçº¿å›æ”¾
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è®¡ç®—ç»“æœ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º é€æ—¥ç›¯å¸‚ç›ˆäºè®¡ç®—
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ç»Ÿè®¡åˆ†æ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º å¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ç­‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. ç”Ÿæˆå›¾è¡¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å›æµ‹æ¨¡å¼

**Kçº¿æ¨¡å¼ï¼ˆBARï¼‰**ï¼š
- ä½¿ç”¨ K çº¿æ•°æ®å›æµ‹
- æˆäº¤é€»è¾‘åŸºäº K çº¿çš„å¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·
- é€Ÿåº¦å¿«ï¼Œé€‚åˆå¤§èŒƒå›´å›æµ‹
- ç²¾åº¦è¾ƒä½

**Tick æ¨¡å¼**ï¼š
- ä½¿ç”¨ Tick æ•°æ®å›æµ‹
- æˆäº¤é€»è¾‘åŸºäº Tick çš„ä¹°å–ä»·æ ¼
- é€Ÿåº¦æ…¢ï¼Œé€‚åˆç²¾ç»†å›æµ‹
- ç²¾åº¦é«˜

### 4.3 å‚æ•°ä¼˜åŒ–

**æš´åŠ›æœç´¢**ï¼š
- éå†æ‰€æœ‰å‚æ•°ç»„åˆ
- é€‚åˆå‚æ•°ç©ºé—´è¾ƒå°çš„æƒ…å†µ
- æ”¯æŒå¤šè¿›ç¨‹å¹¶è¡Œè®¡ç®—

**é—ä¼ ç®—æ³•**ï¼š
- ä½¿ç”¨è¿›åŒ–ç®—æ³•å¯»æ‰¾æœ€ä¼˜è§£
- é€‚åˆå‚æ•°ç©ºé—´è¾ƒå¤§çš„æƒ…å†µ
- å¯åœ¨è¾ƒå°‘è¿­ä»£æ¬¡æ•°å†…æ‰¾åˆ°è¾ƒå¥½è§£

**ä¼˜åŒ–ç›®æ ‡**ï¼š
- `sharpe_ratio` - å¤æ™®æ¯”ç‡
- `annual_return` - å¹´åŒ–æ”¶ç›Šç‡
- `max_drawdown` - æœ€å¤§å›æ’¤ï¼ˆè¶Šå°è¶Šå¥½ï¼‰
- `return_drawdown_ratio` - æ”¶ç›Šå›æ’¤æ¯”
- `rgr_ratio` - RGR æ¯”ç‡ï¼ˆç»¼åˆæŒ‡æ ‡ï¼‰

### 4.4 ç»Ÿè®¡æŒ‡æ ‡

**åŸºç¡€æŒ‡æ ‡**ï¼š
- æ€»æ”¶ç›Šç‡
- å¹´åŒ–æ”¶ç›Šç‡
- æœ€å¤§å›æ’¤
- æœ€å¤§å›æ’¤æŒç»­æ—¶é—´
- ç›ˆåˆ©å¤©æ•° / äºæŸå¤©æ•°

**é£é™©æŒ‡æ ‡**ï¼š
- Sharpe Ratioï¼ˆå¤æ™®æ¯”ç‡ï¼‰
- EWM Sharpeï¼ˆæŒ‡æ•°åŠ æƒå¤æ™®æ¯”ç‡ï¼‰
- æ”¶ç›Šå›æ’¤æ¯”
- RGR Ratioï¼ˆç»¼åˆé£é™©æ”¶ç›Šæ¯”ï¼‰

**äº¤æ˜“æŒ‡æ ‡**ï¼š
- æ€»æˆäº¤é¢
- æ€»æ‰‹ç»­è´¹
- æ€»æ»‘ç‚¹æˆæœ¬
- èƒœç‡
- ç›ˆäºæ¯”

---

## 5. æ•°æ®æºä¸å®æ—¶æ•°æ®

### 5.1 æ•°æ®æº

**OpenCTP TTSï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰**ï¼š
- å…è´¹çš„æ¨¡æ‹Ÿäº¤æ˜“ç¯å¢ƒ
- æ•°æ®æ¥è¿‘å®ç›˜
- ç”¨äºç­–ç•¥æµ‹è¯•å’ŒéªŒè¯

**é…ç½®ä¿¡æ¯**ï¼š
```
ç”¨æˆ·å: 17130
å¯†ç : 123456
ç»çºªå•†ä»£ç : 9999
äº¤æ˜“æœåŠ¡å™¨: 180.168.146.187:10130
è¡Œæƒ…æœåŠ¡å™¨: 180.168.146.187:10131
```

### 5.2 å®æ—¶æ•°æ® API

**è¡Œæƒ…è®¢é˜…**ï¼š
```python
# è®¢é˜…åˆçº¦è¡Œæƒ…
engine.subscribe(symbol, exchange)

# è¡Œæƒ…å›è°ƒ
def on_tick(self, tick: TickData):
    self.last_price = tick.last_price
    self.volume = tick.volume
```

**è®¢å•æ¨é€**ï¼š
```python
# å‘é€è®¢å•
vt_orderid = self.send_order(
    symbol="IF2602.CFFEX",
    direction=Direction.LONG,
    offset=Offset.OPEN,
    order_type=OrderType.LIMIT,
    price=4000.0,
    volume=1
)

# è®¢å•å›è°ƒ
def on_order(self, order: OrderData):
    print(f"è®¢å•çŠ¶æ€: {order.status}")
```

**æˆäº¤æ¨é€**ï¼š
```python
# æˆäº¤å›è°ƒ
def on_trade(self, trade: TradeData):
    print(f"æˆäº¤: {trade.symbol} @ {trade.price}, æ•°é‡: {trade.volume}")
```

### 5.3 æ•°æ®ä¸‹è½½

**å†å²æ•°æ®ä¸‹è½½**ï¼š
```python
from vnpy.trader.database import get_database
from vnpy.trader.object import BarData
from datetime import datetime

# ä¸‹è½½æ•°æ®åˆ°æ•°æ®åº“
database = get_database()
database.save_bar_data(bars)

# ä»æ•°æ®åº“åŠ è½½
start = datetime(2024, 1, 1)
end = datetime(2024, 12, 31)
bars = database.load_bar_data(
    symbol="IF2602",
    exchange=Exchange.CFFEX,
    interval=Interval.MINUTE,
    start=start,
    end=end
)
```

**æ•°æ®æ ¼å¼æ”¯æŒ**ï¼š
- CSV
- Excel
- JSON
- Parquetï¼ˆæ¨èï¼‰

---

## 6. ç½‘é¡µéƒ¨ç½²æ–¹æ¡ˆ

### 6.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTPS/WSS    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    RPC     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Web è¿›ç¨‹    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  äº¤æ˜“è¿›ç¨‹    â”‚
â”‚  (React/Vue) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (FastAPI)    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (VnPy)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ WebSocket
                                    â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å®æ—¶æ¨é€     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Web åŠŸèƒ½è§„åˆ’

**äº¤æ˜“ç®¡ç†**ï¼š
- æ‰‹åŠ¨ä¸‹å•ï¼ˆå¸‚ä»·å•ã€é™ä»·å•ã€æ­¢æŸå•ã€æ¡ä»¶å•ï¼‰
- è®¢å•ç®¡ç†ï¼ˆæŸ¥è¯¢ã€æ’¤é”€ã€ä¿®æ”¹ï¼‰
- æŒä»“æŸ¥è¯¢
- èµ„é‡‘æŸ¥è¯¢
- æˆäº¤è®°å½•æŸ¥è¯¢

**è¡Œæƒ…å±•ç¤º**ï¼š
- å®æ—¶è¡Œæƒ…æ¨é€
- K çº¿å›¾è¡¨ï¼ˆæ”¯æŒå¤šå‘¨æœŸï¼‰
- æ·±åº¦å›¾
- æˆäº¤æ˜ç»†

**ç­–ç•¥ç®¡ç†**ï¼š
- ç­–ç•¥å¯åœ
- ç­–ç•¥å‚æ•°é…ç½®
- ç­–ç•¥æ—¥å¿—æŸ¥çœ‹
- ç­–ç•¥ç»©æ•ˆåˆ†æ

**å›æµ‹åŠŸèƒ½**ï¼š
- å‚æ•°è®¾ç½®
- å›æµ‹æ‰§è¡Œ
- ç»“æœå±•ç¤º
- å‚æ•°ä¼˜åŒ–

**æ•°æ®ç®¡ç†**ï¼š
- æ•°æ®ä¸‹è½½
- æ•°æ®å¯¼å…¥å¯¼å‡º
- æ•°æ®å¤‡ä»½æ¢å¤

### 6.3 éƒ¨ç½²æ–¹å¼

**å•æœºéƒ¨ç½²**ï¼š
```
æœåŠ¡å™¨:
  - äº¤æ˜“è¿›ç¨‹ (Python)
  - Web è¿›ç¨‹ (Python + FastAPI)
  - Nginx (åå‘ä»£ç†)
  - é™æ€æ–‡ä»¶ (React/Vue)
```

**åˆ†å¸ƒå¼éƒ¨ç½²**ï¼š
```
äº¤æ˜“æœåŠ¡å™¨:
  - äº¤æ˜“è¿›ç¨‹ (Python)

Web æœåŠ¡å™¨:
  - Web è¿›ç¨‹ (Python + FastAPI)
  - é™æ€æ–‡ä»¶ (React/Vue)

è´Ÿè½½å‡è¡¡å™¨:
  - Nginx
```

### 6.4 è®¤è¯ä¸å®‰å…¨

**è®¤è¯æ–¹å¼**ï¼š
- JWT Token è®¤è¯
- æ”¯æŒ Token è¿‡æœŸæ—¶é—´è®¾ç½®

**å®‰å…¨æªæ–½**ï¼š
- HTTPS åŠ å¯†ä¼ è¾“
- WSS åŠ å¯† WebSocket
- API è°ƒç”¨é¢‘ç‡é™åˆ¶
- æ“ä½œå®¡è®¡æ—¥å¿—

---

## 7. ä½¿ç”¨æŒ‡å—

### 7.1 å¿«é€Ÿå¼€å§‹

#### 7.1.1 å®‰è£… VnPy

```bash
# æ–¹å¼ 1ï¼špip å®‰è£…
pip install vnpy

# æ–¹å¼ 2ï¼šä»æºç å®‰è£…
git clone https://github.com/vnpy/vnpy.git
cd vnpy
pip install -e .
```

#### 7.1.2 é…ç½®æ•°æ®åº“

**ä½¿ç”¨ SQLiteï¼ˆé»˜è®¤ï¼‰**ï¼š
```python
# æ— éœ€é¢å¤–é…ç½®ï¼Œè‡ªåŠ¨ä½¿ç”¨ database.db
```

**ä½¿ç”¨ MySQL**ï¼š
```python
# ä¿®æ”¹ vnpy.trader.setting.json
{
  "database.name": "mysql",
  "database.host": "localhost",
  "database.port": 3306,
  "database.username": "your_username",
  "database.password": "your_password",
  "database.database": "vnpy"
}
```

#### 7.1.3 è¿è¡Œæµ‹è¯•

```bash
cd /root/.openclaw/workspace/quant-factory

# è¿è¡Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
python3 complete_test_suite.py

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python3 run_all_tests.py
```

### 7.2 å¼€å‘ç­–ç•¥

#### 7.2.1 ç­–ç•¥æ¨¡æ¿

```python
from vnpy_ctastrategy.template import CtaTemplate
from vnpy.trader.object import TickData, BarData
from vnpy.trader.constant import Interval, Direction, Offset

class MyStrategy(CtaTemplate):
    """è‡ªå®šä¹‰ç­–ç•¥"""

    author = "Your Name"

    # ç­–ç•¥å‚æ•°
    fast_window = 10
    slow_window = 20
    fixed_size = 1

    # ç­–ç•¥å˜é‡
    ma_fast = 0.0
    ma_slow = 0.0

    parameters = ["fast_window", "slow_window", "fixed_size"]
    variables = ["ma_fast", "ma_slow"]

    def __init__(self, cta_engine, strategy_name, vt_symbol, setting):
        super().__init__(cta_engine, strategy_name, vt_symbol, setting)
        self.bg = BarGenerator(self.on_bar, self.slow_window, self.on_window_bar)

    def on_init(self):
        """ç­–ç•¥åˆå§‹åŒ–"""
        self.write_log("ç­–ç•¥åˆå§‹åŒ–")
        self.load_bar(self.slow_window)

    def on_start(self):
        """ç­–ç•¥å¯åŠ¨"""
        self.write_log("ç­–ç•¥å¯åŠ¨")

    def on_stop(self):
        """ç­–ç•¥åœæ­¢"""
        self.write_log("ç­–ç•¥åœæ­¢")

    def on_bar(self, bar: BarData):
        """Kçº¿å›è°ƒ"""
        self.bg.update_bar(bar)

    def on_window_bar(self, bar: BarData):
        """åˆæˆKçº¿å›è°ƒ"""
        # è®¡ç®—æŒ‡æ ‡
        self.ma_fast = self.am.sma(self.fast_window)
        self.ma_slow = self.am.sma(self.slow_window)

        # äº¤æ˜“é€»è¾‘
        if self.pos == 0:
            if self.ma_fast > self.ma_slow:
                self.buy(bar.close_price, self.fixed_size)
            elif self.ma_fast < self.ma_slow:
                self.short(bar.close_price, self.fixed_size)

        elif self.pos > 0:
            if self.ma_fast < self.ma_slow:
                self.sell(bar.close_price, abs(self.pos))

        elif self.pos < 0:
            if self.ma_fast > self.ma_slow:
                self.cover(bar.close_price, abs(self.pos))
```

#### 7.2.2 è¿è¡Œå›æµ‹

```python
from vnpy_ctastrategy.backtesting import BacktestingEngine
from datetime import datetime

# åˆ›å»ºå›æµ‹å¼•æ“
engine = BacktestingEngine()

# è®¾ç½®å›æµ‹å‚æ•°
engine.set_parameters(
    vt_symbol="IF2602.CFFEX",
    interval=Interval.MINUTE,
    start=datetime(2024, 1, 1),
    end=datetime(2024, 12, 31),
    rate=0.3/10000,      # æ‰‹ç»­è´¹ç‡
    slippage=0.2,        # æ»‘ç‚¹
    size=300,            # åˆçº¦ä¹˜æ•°
    pricetick=0.2,       # æœ€å°ä»·æ ¼å•ä½
    capital=1_000_000,   # åˆå§‹èµ„é‡‘
)

# æ·»åŠ ç­–ç•¥
engine.add_strategy(MyStrategy, {
    "fast_window": 10,
    "slow_window": 20,
    "fixed_size": 1
})

# åŠ è½½å†å²æ•°æ®
engine.load_data()

# è¿è¡Œå›æµ‹
engine.run_backtesting()

# è®¡ç®—ç»“æœ
df = engine.calculate_result()
stats = engine.calculate_statistics()

# æ˜¾ç¤ºç»“æœ
print(f"å¤æ™®æ¯”ç‡: {stats['sharpe_ratio']:.2f}")
print(f"å¹´åŒ–æ”¶ç›Šç‡: {stats['annual_return']:.2f}%")
print(f"æœ€å¤§å›æ’¤: {stats['max_ddpercent']:.2f}%")
```

### 7.3 è¿è¡Œå®ç›˜

#### 7.3.1 é…ç½® CTP ç½‘å…³

**ctp_gateway_setting.json**ï¼š
```json
{
  "userid": "17130",
  "password": "123456",
  "brokerid": "9999",
  "td_address": "180.168.146.187:10130",
  "md_address": "180.168.146.187:10131",
  "appid": "simnow_client_test",
  "auth_code": "0000000000000000",
  "product_info": ""
}
```

#### 7.3.2 å¯åŠ¨äº¤æ˜“

```python
from vnpy.event import EventEngine
from vnpy.trader.engine import MainEngine
from vnpy.trader.ui import MainWindow
from vnpy.gateway.ctp import CtpGateway
from vnpy_ctastrategy import CtaStrategyApp
from vnpy_ctastrategy.base import EVENT_CTA_LOG

# åˆ›å»ºäº‹ä»¶å¼•æ“å’Œä¸»å¼•æ“
event_engine = EventEngine()
main_engine = MainEngine(event_engine)

# æ·»åŠ  CTP ç½‘å…³
main_engine.add_gateway(CtpGateway)

# æ·»åŠ  CTA ç­–ç•¥åº”ç”¨
cta_engine = CtaStrategyApp(main_engine, event_engine)

# è¿æ¥ CTP
main_engine.connect("CTP")

# å¯åŠ¨ç­–ç•¥
cta_engine.init_strategy("MyStrategy_v1")
cta_engine.start_strategy("MyStrategy_v1")
```

### 7.4 ä½¿ç”¨ Web API

#### 7.4.1 è·å– Token

```python
import requests

url = "http://127.0.0.1:8000/"
r = requests.post(
    url + "token",
    data={"username": "vnpy", "password": "vnpy"}
)
token = r.json()["access_token"]
```

#### 7.4.2 è®¢é˜…è¡Œæƒ…

```python
r = requests.post(
    f"{url}tick/IF2602.CFFEX",
    headers={"Authorization": f"Bearer {token}"}
)
```

#### 7.4.3 å‘é€è®¢å•

```python
order_req = {
    "symbol": "IF2602",
    "exchange": "CFFEX",
    "direction": "å¤š",
    "type": "é™ä»·",
    "volume": 1,
    "price": 4000.0,
    "offset": "å¼€",
    "reference": "WebTrader"
}

r = requests.post(
    f"{url}order",
    json=order_req,
    headers={"Authorization": f"Bearer {token}"}
)
vt_orderid = r.json()["data"]
```

#### 7.4.4 WebSocket å®æ—¶æ¨é€

```python
from websocket import create_connection
import json

ws = create_connection(f"ws://127.0.0.1:8000/ws/?token={token}")

while True:
    message = ws.recv()
    msg_obj = json.loads(message)
    msg_type = msg_obj.get("type")
    data = msg_obj.get("data")

    if msg_type == "tick":
        print(f"è¡Œæƒ…: {data['symbol']} @ {data['last_price']}")
    elif msg_type == "order":
        print(f"è®¢å•: {data['orderid']} - {data['status']}")
    elif msg_type == "trade":
        print(f"æˆäº¤: {data['symbol']} @ {data['price']}")
```

---

## 8. æŠ€æœ¯æ¶æ„

### 8.1 è®¾è®¡æ¨¡å¼

**äº‹ä»¶é©±åŠ¨æ¨¡å¼**ï¼š
- æ‰€æœ‰çš„äº¤æ˜“åŠ¨ä½œéƒ½æ˜¯äº‹ä»¶é©±åŠ¨çš„
- ä¸»å¼•æ“è´Ÿè´£äº‹ä»¶åˆ†å‘
- å„ç±»å¼•æ“è®¢é˜…æ„Ÿå…´è¶£çš„äº‹ä»¶

**ç­–ç•¥æ¨¡å¼**ï¼š
- æ•°æ®åº“æŠ½è±¡å±‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼
- æ”¯æŒå¤šç§æ•°æ®åº“å®ç°

**å·¥å‚æ¨¡å¼**ï¼š
- æ•°æ®åº“å®ä¾‹é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»º
- æ”¯æŒåŠ¨æ€åˆ‡æ¢æ•°æ®åº“

**æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼š
- ç­–ç•¥åŸºç±»å®šä¹‰ç®—æ³•éª¨æ¶
- å­ç±»å®ç°å…·ä½“é€»è¾‘

### 8.2 æ¨¡å—ä¾èµ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å±‚                        â”‚
â”‚  â€¢ ç­–ç•¥åº”ç”¨ï¼ˆCTAã€ç»„åˆã€æœŸæƒç­‰ï¼‰        â”‚
â”‚  â€¢ Web åº”ç”¨ï¼ˆFastAPIã€Reactï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¼•æ“å±‚                        â”‚
â”‚  â€¢ ä¸»å¼•æ“ï¼ˆMainEngineï¼‰                â”‚
â”‚  â€¢ äº‹ä»¶å¼•æ“ï¼ˆEventEngineï¼‰             â”‚
â”‚  â€¢ å„ç±»ç­–ç•¥å¼•æ“                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç½‘å…³å±‚                        â”‚
â”‚  â€¢ CTP ç½‘å…³                            â”‚
â”‚  â€¢ å…¶ä»–ç½‘å…³ï¼ˆæœŸè´§ã€è‚¡ç¥¨ã€å¤–ç›˜ç­‰ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ•°æ®åº“å±‚                      â”‚
â”‚  â€¢ SQLite / MySQL / PostgreSQL         â”‚
â”‚  â€¢ æ•°æ®æŠ½è±¡å±‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 æ€§èƒ½ä¼˜åŒ–

**æ•°æ®åŠ è½½ä¼˜åŒ–**ï¼š
- ä½¿ç”¨ LRU ç¼“å­˜ï¼ˆ@lru_cacheï¼‰
- åˆ†æ‰¹åŠ è½½æ•°æ®ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰
- å¹¶è¡ŒåŠ è½½ï¼ˆå¤šè¿›ç¨‹ï¼‰

**å›æµ‹ä¼˜åŒ–**ï¼š
- ä½¿ç”¨ NumPy åŠ é€Ÿè®¡ç®—
- æ»‘åŠ¨çª—å£å‡å°‘å†…å­˜å ç”¨
- å¤šè¿›ç¨‹å‚æ•°ä¼˜åŒ–

**æ•°æ®åº“ä¼˜åŒ–**ï¼š
- å¤åˆç´¢å¼•è®¾è®¡
- åˆ†é¡µæŸ¥è¯¢
- æ‰¹é‡æ“ä½œ

**Web API ä¼˜åŒ–**ï¼š
- è¿æ¥æ± å¤ç”¨
- WebSocket é•¿è¿æ¥
- æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†

---

## 9. é¡¹ç›®è¿›åº¦ä¸æœªæ¥è§„åˆ’

### 9.1 å½“å‰è¿›åº¦

```
æ€»ä½“è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%

âœ… æµ‹è¯•è§„åˆ’: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
âœ… æ–‡æ¡£ç¼–å†™: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
âœ… æ ¸å¿ƒåŠŸèƒ½: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
ğŸ”„ ç­–ç•¥åŠŸèƒ½: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  40%
â¸ï¸ å›æµ‹åŠŸèƒ½: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
â¸ï¸ æ•°æ®åŠŸèƒ½: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
â¸ï¸ é«˜çº§åŠŸèƒ½: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
â¸ï¸ Web UI:   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
```

### 9.2 å·²å®Œæˆé‡Œç¨‹ç¢‘

- âœ… 2026-02-19: å¤šä»£ç†ç³»ç»Ÿé…ç½®
- âœ… 2026-02-19: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼ˆ8/8 é€šè¿‡ï¼‰
- âœ… 2026-02-20: æ€§èƒ½ä¼˜åŒ–ï¼ˆè´¦æˆ·æŸ¥è¯¢ 4.92s â†’ 0.00sï¼‰
- âœ… 2026-02-20: å®Œæ•´æµ‹è¯•è®¡åˆ’æ–‡æ¡£ï¼ˆ20 ä¸ªæ¨¡å—ï¼‰
- âœ… 2026-02-20: å®Œæ•´å®‰è£…ä¸ä½¿ç”¨æŒ‡å—ï¼ˆ13 ç« ï¼‰
- âœ… 2026-02-20: æ·±åº¦è§£ææ–‡æ¡£ï¼ˆ20+ ç¯‡ï¼‰
- âœ… 2026-02-20: æµ‹è¯•è„šæœ¬åˆ›å»ºï¼ˆ4 ä¸ªå®Œæ•´æµ‹è¯•ï¼‰
- âœ… 2026-02-20: ä¸»æµ‹è¯•è„šæœ¬ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
- âœ… 2026-02-21: é¡¹ç›®å®Œæ•´åˆ†ææŠ¥å‘Š

### 9.3 å¾…å®Œæˆé‡Œç¨‹ç¢‘

**çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰**ï¼š
- â¸ï¸ å®Œæˆ CTA ç­–ç•¥å®Œæ•´æµ‹è¯•
- â¸ï¸ å®Œæˆå›æµ‹åŠŸèƒ½æµ‹è¯•
- â¸ï¸ å®Œæˆæ•°æ®ç®¡ç†æµ‹è¯•
- â¸ï¸ å¼€å§‹ Web UI å¼€å‘

**ä¸­æœŸï¼ˆ2-4 å‘¨ï¼‰**ï¼š
- â¸ï¸ å®Œæˆé«˜çº§åŠŸèƒ½æµ‹è¯•
- â¸ï¸ å®Œæˆé£é™©ç®¡ç†æµ‹è¯•
- â¸ï¸ å®Œæˆç»„åˆç­–ç•¥æµ‹è¯•
- â¸ï¸ å®ŒæˆæœŸæƒäº¤æ˜“æµ‹è¯•
- â¸ï¸ å®Œæˆç®—æ³•äº¤æ˜“æµ‹è¯•

**é•¿æœŸï¼ˆ1-2 ä¸ªæœˆï¼‰**ï¼š
- â¸ï¸ å®Œæˆ Web åç«¯ API å¼€å‘
- â¸ï¸ å®Œæˆ Web å‰ç«¯ UI å¼€å‘
- â¸ï¸ å®Œæˆé›†æˆæµ‹è¯•
- â¸ï¸ éƒ¨ç½²ä¸Šçº¿

### 9.4 æŠ€æœ¯å€ºåŠ¡

- éœ€è¦æ¸…ç†ä¸´æ—¶æµ‹è¯•æ–‡ä»¶ï¼ˆdebug_*.pyã€test_*_fixed.py ç­‰ï¼‰
- éœ€è¦ç»Ÿä¸€æ—¥å¿—æ ¼å¼
- éœ€è¦å®Œå–„å•å…ƒæµ‹è¯•è¦†ç›–ç‡
- éœ€è¦æ·»åŠ  CI/CD æµç¨‹

---

## é™„å½•

### A. å¸¸è§é—®é¢˜

**Q1: VnPy æ”¯æŒå“ªäº›å¸‚åœºï¼Ÿ**
A: VnPy æ”¯æŒå›½å†…æœŸè´§ï¼ˆCTPï¼‰ã€è‚¡ç¥¨ã€æœŸæƒã€å¤–ç›˜ç­‰å¸‚åœºï¼Œå…·ä½“å–å†³äºç½‘å…³æ”¯æŒã€‚

**Q2: å¦‚ä½•è·å–å†å²æ•°æ®ï¼Ÿ**
A: å¯ä»¥ä»äº¤æ˜“æ‰€å®˜ç½‘ã€æ•°æ®æœåŠ¡å•†ä¸‹è½½ï¼Œæˆ–ä½¿ç”¨ VnPy çš„æ•°æ®ä¸‹è½½åŠŸèƒ½ã€‚

**Q3: å›æµ‹å’Œå®ç›˜çš„å·®å¼‚æœ‰å¤šå¤§ï¼Ÿ**
A: å›æµ‹æ˜¯ç†æƒ³åŒ–çš„ï¼Œå®é™…äº¤æ˜“ä¸­ä¼šå­˜åœ¨æ»‘ç‚¹ã€å»¶è¿Ÿã€æµåŠ¨æ€§ä¸è¶³ç­‰é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ Tick æ¨¡å¼è¿›è¡Œç²¾ç»†å›æµ‹ã€‚

**Q4: å¦‚ä½•ä¼˜åŒ–ç­–ç•¥å‚æ•°ï¼Ÿ**
A: VnPy æä¾›äº†æš´åŠ›æœç´¢å’Œé—ä¼ ç®—æ³•ä¸¤ç§ä¼˜åŒ–æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®å‚æ•°ç©ºé—´å¤§å°é€‰æ‹©ã€‚

**Q5: Web API æ”¯æŒå“ªäº›åŠŸèƒ½ï¼Ÿ**
A: æ”¯æŒäº¤æ˜“ç®¡ç†ã€è¡Œæƒ…æŸ¥è¯¢ã€ç­–ç•¥å¯åœã€æ•°æ®ç®¡ç†ç­‰åŠŸèƒ½ï¼Œåç»­ä¼šæŒç»­æ‰©å±•ã€‚

### B. å­¦ä¹ èµ„æº

**å®˜æ–¹èµ„æº**ï¼š
- VnPy å®˜ç½‘: https://www.vnpy.com
- VnPy æ–‡æ¡£: https://docs.vnpy.com
- VnPy ç¤¾åŒº: https://www.vnpy.com/forum

**æ•°æ®æº**ï¼š
- OpenCTP: http://openctp.cn
- SimNow: http://www.simnow.com.cn

### C. è”ç³»æ–¹å¼

- é¡¹ç›®è´Ÿè´£äºº: æ€»æŒ‡æŒ¥ (zongzhihui)
- è°ƒåº¦è€…: ç ”ç©¶å‘˜ (researcher)
- æŠ€æœ¯æ”¯æŒ: VnPy ç¤¾åŒº

---

**æŠ¥å‘Šå®Œæˆæ—¥æœŸ**: 2026-02-21
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•å®Œæˆï¼Œå‡†å¤‡ Web UI å¼€å‘
